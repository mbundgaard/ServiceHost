<Window x:Class="ServiceHost.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ServiceHost"
        xmlns:vm="clr-namespace:ServiceHost.ViewModels"
        xmlns:models="clr-namespace:ServiceHost.Models"
        Title="{Binding WindowTitle}"
        Height="650" Width="1000"
        MinHeight="450" MinWidth="700"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundDarkBrush}">

    <Window.Resources>
        <local:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header / Toolbar -->
        <Border Grid.Row="0"
                Background="{StaticResource BackgroundMediumBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left: Action Buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Content="Start All"
                            Command="{Binding StartAllCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            Margin="0,0,8,0"/>
                    <Button Content="Stop All"
                            Command="{Binding StopAllCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"/>
                </StackPanel>

                <!-- Right: GitHub + Copy Prompt + API Status -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Click="GitHub_Click"
                            ToolTip="Open GitHub repository"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Margin="0,0,8,0"
                            Padding="10,6">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
                                  Fill="{StaticResource TextPrimaryBrush}"
                                  Width="14" Height="14"
                                  Stretch="Uniform"
                                  Margin="0,0,6,0"/>
                            <TextBlock Text="GitHub"/>
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding CopyPromptCommand}"
                            ToolTip="Copy Claude Code prompt to clipboard"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Margin="0,0,12,0"
                            Padding="10,6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#128203;" FontSize="12" Margin="0,0,6,0"/>
                            <TextBlock Text="Copy Prompt"/>
                        </StackPanel>
                    </Button>
                    <Border Background="{StaticResource BackgroundLightBrush}"
                            CornerRadius="4"
                            Padding="12,6">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="API"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontWeight="Medium"
                                       Margin="0,0,8,0"/>
                            <TextBlock Text=":" Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding ApiPort}"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       FontWeight="Medium"
                                       Margin="0,0,10,0"/>
                            <Ellipse Width="8" Height="8"
                                     Fill="{StaticResource SuccessBrush}"
                                     VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="250"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" MinWidth="350"/>
            </Grid.ColumnDefinitions>

            <!-- Service List Panel -->
            <Border Grid.Column="0"
                    Background="{StaticResource BackgroundMediumBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Section Header -->
                    <Border Grid.Row="0" Padding="16,14">
                        <TextBlock Text="SERVICES"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   />
                    </Border>

                    <!-- Service List -->
                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding Services}"
                             SelectedItem="{Binding SelectedService}"
                             Style="{StaticResource ModernListBoxStyle}"
                             ItemContainerStyle="{StaticResource ModernListBoxItemStyle}"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             Padding="4,0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Status Indicator -->
                                    <Ellipse Grid.Column="0"
                                             Width="10" Height="10"
                                             Margin="0,0,12,0"
                                             VerticalAlignment="Center"
                                             Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}"/>

                                    <!-- Service Info -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}"
                                                   FontSize="13"
                                                   FontWeight="Medium"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock FontSize="11"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   Margin="0,2,0,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="Stopped"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Status}" Value="Running">
                                                            <Setter Property="Text" Value="Running"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Starting">
                                                            <Setter Property="Text" Value="Starting..."/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Stopping">
                                                            <Setter Property="Text" Value="Stopping..."/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Status}" Value="Failed">
                                                            <Setter Property="Text" Value="Failed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Action Buttons -->
                                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                                        <Button Command="{Binding StartCommand}"
                                                Style="{StaticResource IconButtonStyle}"
                                                ToolTip="Start"
                                                IsEnabled="{Binding IsOperating, Converter={StaticResource InverseBoolConverter}}">
                                            <TextBlock Text="&#9654;" FontSize="10" Foreground="{StaticResource SuccessBrush}"/>
                                        </Button>
                                        <Button Command="{Binding StopCommand}"
                                                Style="{StaticResource IconButtonStyle}"
                                                ToolTip="Stop"
                                                IsEnabled="{Binding IsOperating, Converter={StaticResource InverseBoolConverter}}">
                                            <TextBlock Text="&#9632;" FontSize="11" Foreground="{StaticResource DangerBrush}"/>
                                        </Button>
                                        <Button Command="{Binding RestartCommand}"
                                                Style="{StaticResource IconButtonStyle}"
                                                ToolTip="Restart"
                                                IsEnabled="{Binding IsOperating, Converter={StaticResource InverseBoolConverter}}">
                                            <TextBlock Text="&#8635;" FontSize="14" Foreground="{StaticResource AccentBrush}"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1"
                          Width="1"
                          Background="{StaticResource BorderBrush}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Stretch"/>

            <!-- Log Viewer Panel -->
            <Border Grid.Column="2" Background="{StaticResource BackgroundDarkBrush}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Log Header -->
                    <Border Grid.Row="0"
                            Background="{StaticResource BackgroundMediumBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="16,14">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="LOGS"
                                           FontSize="11"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text=" â€” "
                                           FontSize="11"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text="{Binding SelectedService.Name, FallbackValue='Select a service', Mode=OneWay}"
                                           FontSize="11"
                                           FontWeight="Medium"
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <TextBlock Text="{Binding SelectedService.Url, Mode=OneWay}"
                                           FontSize="11"
                                           Foreground="{StaticResource AccentBrush}"
                                           VerticalAlignment="Center"
                                           Cursor="Hand"
                                           ToolTip="Open in browser"
                                           MouseLeftButtonUp="ServiceUrl_Click"
                                           Margin="0,0,12,0"
                                           Visibility="{Binding SelectedService.HasUrl, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="TextDecorations" Value="Underline"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button Command="{Binding ClearLogCommand}"
                                        Style="{StaticResource IconButtonStyle}"
                                        ToolTip="Clear log"
                                        Width="24" Height="24"
                                        Margin="0,0,8,0"
                                        Visibility="{Binding HasSelectedService, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <TextBlock Text="&#128465;" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </Button>
                                <CheckBox x:Name="WordWrapCheckBox"
                                          Content="Wrap"
                                          IsChecked="True"
                                          Foreground="{StaticResource TextSecondaryBrush}"
                                          VerticalAlignment="Center"
                                          FontSize="11"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Log Content -->
                    <TextBox Grid.Row="1"
                             Text="{Binding LogContent, Mode=OneWay}"
                             IsReadOnly="True"
                             FontFamily="Cascadia Mono, Consolas, monospace"
                             FontSize="12"
                             Background="#0d0d0d"
                             Foreground="#cccccc"
                             BorderThickness="0"
                             Padding="16,12"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             x:Name="LogTextBox">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="CaretBrush" Value="#cccccc"/>
                                <Setter Property="SelectionBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="TextWrapping" Value="NoWrap"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsChecked, ElementName=WordWrapCheckBox}" Value="True">
                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Background="{StaticResource BackgroundMediumBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="16,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="{Binding StatusText}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           FontSize="12"/>

                <TextBlock Grid.Column="1"
                           Text="v1.0.0"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           FontSize="11"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
